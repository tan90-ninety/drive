<select id="findNoReceivePage" resultType="com.atguigu.daijia.model.vo.coupon.NoReceiveCouponVo">
	select
	info.id,
	info.coupon_type,
	info.name,
	info.amount,
	info.discount,
	info.condition_amount,
	info.publish_count,
	info.per_limit,
	info.expire_time,
	info.description
	from coupon_info info
	left join (
	select coupon_id, customer_id, count(customer_id) cnt  from customer_coupon where customer_id = #{customerId}  group by coupon_id, customer_id
	) cus_coup on cus_coup.coupon_id = info.id
	where
	info.status = 1
	and info.receive_count &lt; info.publish_count
	and (
	info.per_limit =0 or info.per_limit > cus_coup.cnt or cus_coup.cnt is null
	)
	order by info.id desc
</select>

<select id="findNoUsePage" resultType="com.atguigu.daijia.model.vo.coupon.NoUseCouponVo">
select
info.id,
info.coupon_type,
info.name,
info.amount,
info.discount,
info.condition_amount,
info.publish_count,
info.per_limit,
info.expire_time,
info.description,

cstr.receive_time
from coupon_info info
inner join customer_coupon cstr on cstr.coupon_id = info.id
where
cstr.customer_id = #{customerId}
and cstr.status = 1
and cstr.expire_time > now()
order by cstr.id desc
</select>

<select id="findUsedPage" resultType="com.atguigu.daijia.model.vo.coupon.UsedCouponVo">
select
info.id,
info.coupon_type,
info.name,
info.amount,
info.discount,
info.condition_amount,
info.publish_count,
info.per_limit,
info.expire_time,
info.description,

cstr.id as customerCouponId,
cstr.used_time
from coupon_info info
inner join customer_coupon cstr on cstr.coupon_id = info.id
where
cstr.customer_id = #{customerId}
and cstr.status = 2
order by cstr.id desc
</select>